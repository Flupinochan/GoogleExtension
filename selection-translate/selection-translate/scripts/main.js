(function(){"use strict";const I={withStackTrace:!1},S=(t,r,e=I)=>{const n=r.isOk()?{type:"Ok",value:r.value}:{type:"Err",value:r.error},o=e.withStackTrace?new Error().stack:void 0;return{data:n,message:t,stack:o}};function y(t,r,e,n){function o(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function c(m){try{b(n.next(m))}catch(E){a(E)}}function d(m){try{b(n.throw(m))}catch(E){a(E)}}function b(m){m.done?i(m.value):o(m.value).then(c,d)}b((n=n.apply(t,[])).next())})}function x(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(t){return this instanceof f?(this.v=t,this):new f(t)}function k(t,r,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(t,r||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",a),o[Symbol.asyncIterator]=function(){return this},o;function a(u){return function(v){return Promise.resolve(v).then(u,E)}}function c(u,v){n[u]&&(o[u]=function(g){return new Promise(function(M,N){i.push([u,g,M,N])>1||d(u,g)})},v&&(o[u]=v(o[u])))}function d(u,v){try{b(n[u](v))}catch(g){U(i[0][3],g)}}function b(u){u.value instanceof f?Promise.resolve(u.value.v).then(m,E):U(i[0][2],u)}function m(u){d("next",u)}function E(u){d("throw",u)}function U(u,v){u(v),i.shift(),i.length&&d(i[0][0],i[0][1])}}function C(t){var r,e;return r={},n("next"),n("throw",function(o){throw o}),n("return"),r[Symbol.iterator]=function(){return this},r;function n(o,i){r[o]=t[o]?function(a){return(e=!e)?{value:f(t[o](a)),done:!1}:i?i(a):a}:i}}function L(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t[Symbol.asyncIterator],e;return r?r.call(t):(t=typeof x=="function"?x(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=t[i]&&function(a){return new Promise(function(c,d){a=t[i](a),o(c,d,a.done,a.value)})}}function o(i,a,c,d){Promise.resolve(d).then(function(b){i({value:b,done:c})},a)}}typeof SuppressedError=="function"&&SuppressedError;class s{constructor(r){this._promise=r}static fromSafePromise(r){const e=r.then(n=>new w(n));return new s(e)}static fromPromise(r,e){const n=r.then(o=>new w(o)).catch(o=>new h(e(o)));return new s(n)}static fromThrowable(r,e){return(...n)=>new s(y(this,void 0,void 0,function*(){try{return new w(yield r(...n))}catch(o){return new h(e?e(o):o)}}))}static combine(r){return j(r)}static combineWithAllErrors(r){return A(r)}map(r){return new s(this._promise.then(e=>y(this,void 0,void 0,function*(){return e.isErr()?new h(e.error):new w(yield r(e.value))})))}andThrough(r){return new s(this._promise.then(e=>y(this,void 0,void 0,function*(){if(e.isErr())return new h(e.error);const n=yield r(e.value);return n.isErr()?new h(n.error):new w(e.value)})))}andTee(r){return new s(this._promise.then(e=>y(this,void 0,void 0,function*(){if(e.isErr())return new h(e.error);try{yield r(e.value)}catch{}return new w(e.value)})))}orTee(r){return new s(this._promise.then(e=>y(this,void 0,void 0,function*(){if(e.isOk())return new w(e.value);try{yield r(e.error)}catch{}return new h(e.error)})))}mapErr(r){return new s(this._promise.then(e=>y(this,void 0,void 0,function*(){return e.isOk()?new w(e.value):new h(yield r(e.error))})))}andThen(r){return new s(this._promise.then(e=>{if(e.isErr())return new h(e.error);const n=r(e.value);return n instanceof s?n._promise:n}))}orElse(r){return new s(this._promise.then(e=>y(this,void 0,void 0,function*(){return e.isErr()?r(e.error):new w(e.value)})))}match(r,e){return this._promise.then(n=>n.match(r,e))}unwrapOr(r){return this._promise.then(e=>e.unwrapOr(r))}safeUnwrap(){return k(this,arguments,function*(){return yield f(yield f(yield*C(L(yield f(this._promise.then(e=>e.safeUnwrap()))))))})}then(r,e){return this._promise.then(r,e)}[Symbol.asyncIterator](){return k(this,arguments,function*(){const e=yield f(this._promise);return e.isErr()&&(yield yield f(_(e.error))),yield f(e.value)})}}function _(t){return new s(Promise.resolve(new h(t)))}const O=t=>{let r=p([]);for(const e of t)if(e.isErr()){r=l(e.error);break}else r.map(n=>n.push(e.value));return r},j=t=>s.fromSafePromise(Promise.all(t)).andThen(O),P=t=>{let r=p([]);for(const e of t)e.isErr()&&r.isErr()?r.error.push(e.error):e.isErr()&&r.isOk()?r=l([e.error]):e.isOk()&&r.isOk()&&r.value.push(e.value);return r},A=t=>s.fromSafePromise(Promise.all(t)).andThen(P);var T;(function(t){function r(o,i){return(...a)=>{try{const c=o(...a);return p(c)}catch(c){return l(i?i(c):c)}}}t.fromThrowable=r;function e(o){return O(o)}t.combine=e;function n(o){return P(o)}t.combineWithAllErrors=n})(T||(T={}));function p(t){return new w(t)}function l(t){return new h(t)}class w{constructor(r){this.value=r}isOk(){return!0}isErr(){return!this.isOk()}map(r){return p(r(this.value))}mapErr(r){return p(this.value)}andThen(r){return r(this.value)}andThrough(r){return r(this.value).map(e=>this.value)}andTee(r){try{r(this.value)}catch{}return p(this.value)}orTee(r){return p(this.value)}orElse(r){return p(this.value)}asyncAndThen(r){return r(this.value)}asyncAndThrough(r){return r(this.value).map(()=>this.value)}asyncMap(r){return s.fromSafePromise(r(this.value))}unwrapOr(r){return this.value}match(r,e){return r(this.value)}safeUnwrap(){const r=this.value;return function*(){return r}()}_unsafeUnwrap(r){return this.value}_unsafeUnwrapErr(r){throw S("Called `_unsafeUnwrapErr` on an Ok",this,r)}*[Symbol.iterator](){return this.value}}class h{constructor(r){this.error=r}isOk(){return!1}isErr(){return!this.isOk()}map(r){return l(this.error)}mapErr(r){return l(r(this.error))}andThrough(r){return l(this.error)}andTee(r){return l(this.error)}orTee(r){try{r(this.error)}catch{}return l(this.error)}andThen(r){return l(this.error)}orElse(r){return r(this.error)}asyncAndThen(r){return _(this.error)}asyncAndThrough(r){return _(this.error)}asyncMap(r){return _(this.error)}unwrapOr(r){return r}match(r,e){return e(this.error)}safeUnwrap(){const r=this.error;return function*(){throw yield l(r),new Error("Do not use this generator out of `safeTry`")}()}_unsafeUnwrap(r){throw S("Called `_unsafeUnwrap` on an Err",this,r)}_unsafeUnwrapErr(r){return this.error}*[Symbol.iterator](){const r=this;return yield r,r}}T.fromThrowable,document.addEventListener("mouseup",W);async function W(){const t=await q();if(t.isErr())return;const r=await z(t.value);r.isErr()||(console.log(r.value),D(r.value))}async function q(){const t=window.getSelection();return t!==null&&t.rangeCount>0&&!t.isCollapsed?p(t.toString()):l({code:1,message:"error"})}async function z(t){try{const e=await(await Translator.create({sourceLanguage:"en",targetLanguage:"ja"})).translate(t);return p(e)}catch{return l({code:2,message:"error"})}}function D(t){const r=document.querySelector(".selection-translate-popup");r&&r.remove();const e=window.getSelection();if(!e||e.rangeCount===0)return;const o=e.getRangeAt(0).getBoundingClientRect(),i=document.createElement("div");i.className="selection-translate-popup",i.textContent=t,i.style.cssText=`
    position: absolute;
    left: ${o.left+window.scrollX}px;
    top: ${o.bottom+window.scrollY+5}px;
    z-index: 10000;
    background: #333;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 14px;
    max-width: 300px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  `,document.body.appendChild(i)}})();
