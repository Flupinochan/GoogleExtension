(function(){"use strict";const C={withStackTrace:!1},x=(t,r,e=C)=>{const n=r.isOk()?{type:"Ok",value:r.value}:{type:"Err",value:r.error},o=e.withStackTrace?new Error().stack:void 0;return{data:n,message:t,stack:o}};function v(t,r,e,n){function o(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function c(w){try{g(n.next(w))}catch(b){a(b)}}function f(w){try{g(n.throw(w))}catch(b){a(b)}}function g(w){w.done?i(w.value):o(w.value).then(c,f)}g((n=n.apply(t,[])).next())})}function S(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(t){return this instanceof p?(this.v=t,this):new p(t)}function k(t,r,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(t,r||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",a),o[Symbol.asyncIterator]=function(){return this},o;function a(s){return function(y){return Promise.resolve(y).then(s,b)}}function c(s,y){n[s]&&(o[s]=function(_){return new Promise(function($,B){i.push([s,_,$,B])>1||f(s,_)})},y&&(o[s]=y(o[s])))}function f(s,y){try{g(n[s](y))}catch(_){L(i[0][3],_)}}function g(s){s.value instanceof p?Promise.resolve(s.value.v).then(w,b):L(i[0][2],s)}function w(s){f("next",s)}function b(s){f("throw",s)}function L(s,y){s(y),i.shift(),i.length&&f(i[0][0],i[0][1])}}function U(t){var r,e;return r={},n("next"),n("throw",function(o){throw o}),n("return"),r[Symbol.iterator]=function(){return this},r;function n(o,i){r[o]=t[o]?function(a){return(e=!e)?{value:p(t[o](a)),done:!1}:i?i(a):a}:i}}function I(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t[Symbol.asyncIterator],e;return r?r.call(t):(t=typeof S=="function"?S(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=t[i]&&function(a){return new Promise(function(c,f){a=t[i](a),o(c,f,a.done,a.value)})}}function o(i,a,c,f){Promise.resolve(f).then(function(g){i({value:g,done:c})},a)}}typeof SuppressedError=="function"&&SuppressedError;class u{constructor(r){this._promise=r}static fromSafePromise(r){const e=r.then(n=>new m(n));return new u(e)}static fromPromise(r,e){const n=r.then(o=>new m(o)).catch(o=>new d(e(o)));return new u(n)}static fromThrowable(r,e){return(...n)=>new u(v(this,void 0,void 0,function*(){try{return new m(yield r(...n))}catch(o){return new d(e?e(o):o)}}))}static combine(r){return A(r)}static combineWithAllErrors(r){return j(r)}map(r){return new u(this._promise.then(e=>v(this,void 0,void 0,function*(){return e.isErr()?new d(e.error):new m(yield r(e.value))})))}andThrough(r){return new u(this._promise.then(e=>v(this,void 0,void 0,function*(){if(e.isErr())return new d(e.error);const n=yield r(e.value);return n.isErr()?new d(n.error):new m(e.value)})))}andTee(r){return new u(this._promise.then(e=>v(this,void 0,void 0,function*(){if(e.isErr())return new d(e.error);try{yield r(e.value)}catch{}return new m(e.value)})))}orTee(r){return new u(this._promise.then(e=>v(this,void 0,void 0,function*(){if(e.isOk())return new m(e.value);try{yield r(e.error)}catch{}return new d(e.error)})))}mapErr(r){return new u(this._promise.then(e=>v(this,void 0,void 0,function*(){return e.isOk()?new m(e.value):new d(yield r(e.error))})))}andThen(r){return new u(this._promise.then(e=>{if(e.isErr())return new d(e.error);const n=r(e.value);return n instanceof u?n._promise:n}))}orElse(r){return new u(this._promise.then(e=>v(this,void 0,void 0,function*(){return e.isErr()?r(e.error):new m(e.value)})))}match(r,e){return this._promise.then(n=>n.match(r,e))}unwrapOr(r){return this._promise.then(e=>e.unwrapOr(r))}safeUnwrap(){return k(this,arguments,function*(){return yield p(yield p(yield*U(I(yield p(this._promise.then(e=>e.safeUnwrap()))))))})}then(r,e){return this._promise.then(r,e)}[Symbol.asyncIterator](){return k(this,arguments,function*(){const e=yield p(this._promise);return e.isErr()&&(yield yield p(E(e.error))),yield p(e.value)})}}function E(t){return new u(Promise.resolve(new d(t)))}const O=t=>{let r=h([]);for(const e of t)if(e.isErr()){r=l(e.error);break}else r.map(n=>n.push(e.value));return r},A=t=>u.fromSafePromise(Promise.all(t)).andThen(O),P=t=>{let r=h([]);for(const e of t)e.isErr()&&r.isErr()?r.error.push(e.error):e.isErr()&&r.isOk()?r=l([e.error]):e.isOk()&&r.isOk()&&r.value.push(e.value);return r},j=t=>u.fromSafePromise(Promise.all(t)).andThen(P);var T;(function(t){function r(o,i){return(...a)=>{try{const c=o(...a);return h(c)}catch(c){return l(i?i(c):c)}}}t.fromThrowable=r;function e(o){return O(o)}t.combine=e;function n(o){return P(o)}t.combineWithAllErrors=n})(T||(T={}));function h(t){return new m(t)}function l(t){return new d(t)}class m{constructor(r){this.value=r}isOk(){return!0}isErr(){return!this.isOk()}map(r){return h(r(this.value))}mapErr(r){return h(this.value)}andThen(r){return r(this.value)}andThrough(r){return r(this.value).map(e=>this.value)}andTee(r){try{r(this.value)}catch{}return h(this.value)}orTee(r){return h(this.value)}orElse(r){return h(this.value)}asyncAndThen(r){return r(this.value)}asyncAndThrough(r){return r(this.value).map(()=>this.value)}asyncMap(r){return u.fromSafePromise(r(this.value))}unwrapOr(r){return this.value}match(r,e){return r(this.value)}safeUnwrap(){const r=this.value;return function*(){return r}()}_unsafeUnwrap(r){return this.value}_unsafeUnwrapErr(r){throw x("Called `_unsafeUnwrapErr` on an Ok",this,r)}*[Symbol.iterator](){return this.value}}class d{constructor(r){this.error=r}isOk(){return!1}isErr(){return!this.isOk()}map(r){return l(this.error)}mapErr(r){return l(r(this.error))}andThrough(r){return l(this.error)}andTee(r){return l(this.error)}orTee(r){try{r(this.error)}catch{}return l(this.error)}andThen(r){return l(this.error)}orElse(r){return r(this.error)}asyncAndThen(r){return E(this.error)}asyncAndThrough(r){return E(this.error)}asyncMap(r){return E(this.error)}unwrapOr(r){return r}match(r,e){return e(this.error)}safeUnwrap(){const r=this.error;return function*(){throw yield l(r),new Error("Do not use this generator out of `safeTry`")}()}_unsafeUnwrap(r){throw x("Called `_unsafeUnwrap` on an Err",this,r)}_unsafeUnwrapErr(r){return this.error}*[Symbol.iterator](){const r=this;return yield r,r}}T.fromThrowable,document.addEventListener("mouseup",W);async function W(){const t=await q();if(t.isErr())return;const r=await N(t.value);r.isErr()||console.log(r.value)}async function q(){const t=window.getSelection();if(!t||t.rangeCount===0||t.isCollapsed)return l({code:1,message:"error"});const r=t.getRangeAt(0),e=document.querySelector(".selection-translate-popup");return e&&(e.contains(r.startContainer)||e.contains(r.endContainer))?l({code:1,message:"error"}):h(t.toString())}async function D(t){const r=await LanguageDetector.create();try{const e=await r.detect(t);return h(e[0].detectedLanguage)}catch{return l({code:2,message:"error"})}finally{r.destroy()}}async function N(t){const r=await D(t);if(r.isErr())return l({code:2,message:"error"});const e=await Translator.create({sourceLanguage:r.value,targetLanguage:"ja"});try{const o=e.translateStreaming(t).getReader(),i=z();let a="";try{for(;;){const{done:c,value:f}=await o.read();if(c)break;a+=f,M(i,a)}return h(a)}finally{o.releaseLock()}}catch{return l({code:2,message:"error"})}finally{e.destroy()}}function z(){const t=document.querySelector(".selection-translate-popup");t&&t.remove();const r=window.getSelection();if(!r||r.rangeCount===0)throw new Error("No selection found");const n=r.getRangeAt(0).getBoundingClientRect(),o=document.createElement("div");return o.className="selection-translate-popup",o.textContent="翻訳中...",o.style.cssText=`
  position: absolute;
  left: ${n.left+window.scrollX}px;
  top: ${n.bottom+window.scrollY+5}px;
  z-index: 10000;
  background: linear-gradient(135deg, rgba(255, 75, 75, 0.3), rgba(75, 150, 255, 0.3));
  backdrop-filter: blur(15px) saturate(180%);
  -webkit-backdrop-filter: blur(15px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  padding: 8px 12px;
  border-radius: 12px;
  font-size: 14px;
  max-width: 300px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4),
              0 0 0 1px rgba(255, 255, 255, 0.2) inset,
              0 0 20px rgba(255, 255, 255, 0.1) inset;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.7);
`,document.body.appendChild(o),V(o),o}function M(t,r){t.textContent=r}function V(t){const r=e=>{const n=e.target;t.contains(n)||(t.remove(),document.removeEventListener("click",r))};setTimeout(()=>{document.addEventListener("click",r)},0)}})();
