(function(){"use strict";const U={withStackTrace:!1},x=(t,r,e=U)=>{const n=r.isOk()?{type:"Ok",value:r.value}:{type:"Err",value:r.error},o=e.withStackTrace?new Error().stack:void 0;return{data:n,message:t,stack:o}};function y(t,r,e,n){function o(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function c(w){try{b(n.next(w))}catch(E){a(E)}}function h(w){try{b(n.throw(w))}catch(E){a(E)}}function b(w){w.done?i(w.value):o(w.value).then(c,h)}b((n=n.apply(t,[])).next())})}function S(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(t){return this instanceof p?(this.v=t,this):new p(t)}function k(t,r,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(t,r||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",a),o[Symbol.asyncIterator]=function(){return this},o;function a(s){return function(v){return Promise.resolve(v).then(s,E)}}function c(s,v){n[s]&&(o[s]=function(_){return new Promise(function(M,N){i.push([s,_,M,N])>1||h(s,_)})},v&&(o[s]=v(o[s])))}function h(s,v){try{b(n[s](v))}catch(_){C(i[0][3],_)}}function b(s){s.value instanceof p?Promise.resolve(s.value.v).then(w,E):C(i[0][2],s)}function w(s){h("next",s)}function E(s){h("throw",s)}function C(s,v){s(v),i.shift(),i.length&&h(i[0][0],i[0][1])}}function I(t){var r,e;return r={},n("next"),n("throw",function(o){throw o}),n("return"),r[Symbol.iterator]=function(){return this},r;function n(o,i){r[o]=t[o]?function(a){return(e=!e)?{value:p(t[o](a)),done:!1}:i?i(a):a}:i}}function L(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t[Symbol.asyncIterator],e;return r?r.call(t):(t=typeof S=="function"?S(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=t[i]&&function(a){return new Promise(function(c,h){a=t[i](a),o(c,h,a.done,a.value)})}}function o(i,a,c,h){Promise.resolve(h).then(function(b){i({value:b,done:c})},a)}}typeof SuppressedError=="function"&&SuppressedError;class u{constructor(r){this._promise=r}static fromSafePromise(r){const e=r.then(n=>new m(n));return new u(e)}static fromPromise(r,e){const n=r.then(o=>new m(o)).catch(o=>new f(e(o)));return new u(n)}static fromThrowable(r,e){return(...n)=>new u(y(this,void 0,void 0,function*(){try{return new m(yield r(...n))}catch(o){return new f(e?e(o):o)}}))}static combine(r){return A(r)}static combineWithAllErrors(r){return j(r)}map(r){return new u(this._promise.then(e=>y(this,void 0,void 0,function*(){return e.isErr()?new f(e.error):new m(yield r(e.value))})))}andThrough(r){return new u(this._promise.then(e=>y(this,void 0,void 0,function*(){if(e.isErr())return new f(e.error);const n=yield r(e.value);return n.isErr()?new f(n.error):new m(e.value)})))}andTee(r){return new u(this._promise.then(e=>y(this,void 0,void 0,function*(){if(e.isErr())return new f(e.error);try{yield r(e.value)}catch{}return new m(e.value)})))}orTee(r){return new u(this._promise.then(e=>y(this,void 0,void 0,function*(){if(e.isOk())return new m(e.value);try{yield r(e.error)}catch{}return new f(e.error)})))}mapErr(r){return new u(this._promise.then(e=>y(this,void 0,void 0,function*(){return e.isOk()?new m(e.value):new f(yield r(e.error))})))}andThen(r){return new u(this._promise.then(e=>{if(e.isErr())return new f(e.error);const n=r(e.value);return n instanceof u?n._promise:n}))}orElse(r){return new u(this._promise.then(e=>y(this,void 0,void 0,function*(){return e.isErr()?r(e.error):new m(e.value)})))}match(r,e){return this._promise.then(n=>n.match(r,e))}unwrapOr(r){return this._promise.then(e=>e.unwrapOr(r))}safeUnwrap(){return k(this,arguments,function*(){return yield p(yield p(yield*I(L(yield p(this._promise.then(e=>e.safeUnwrap()))))))})}then(r,e){return this._promise.then(r,e)}[Symbol.asyncIterator](){return k(this,arguments,function*(){const e=yield p(this._promise);return e.isErr()&&(yield yield p(g(e.error))),yield p(e.value)})}}function g(t){return new u(Promise.resolve(new f(t)))}const O=t=>{let r=d([]);for(const e of t)if(e.isErr()){r=l(e.error);break}else r.map(n=>n.push(e.value));return r},A=t=>u.fromSafePromise(Promise.all(t)).andThen(O),P=t=>{let r=d([]);for(const e of t)e.isErr()&&r.isErr()?r.error.push(e.error):e.isErr()&&r.isOk()?r=l([e.error]):e.isOk()&&r.isOk()&&r.value.push(e.value);return r},j=t=>u.fromSafePromise(Promise.all(t)).andThen(P);var T;(function(t){function r(o,i){return(...a)=>{try{const c=o(...a);return d(c)}catch(c){return l(i?i(c):c)}}}t.fromThrowable=r;function e(o){return O(o)}t.combine=e;function n(o){return P(o)}t.combineWithAllErrors=n})(T||(T={}));function d(t){return new m(t)}function l(t){return new f(t)}class m{constructor(r){this.value=r}isOk(){return!0}isErr(){return!this.isOk()}map(r){return d(r(this.value))}mapErr(r){return d(this.value)}andThen(r){return r(this.value)}andThrough(r){return r(this.value).map(e=>this.value)}andTee(r){try{r(this.value)}catch{}return d(this.value)}orTee(r){return d(this.value)}orElse(r){return d(this.value)}asyncAndThen(r){return r(this.value)}asyncAndThrough(r){return r(this.value).map(()=>this.value)}asyncMap(r){return u.fromSafePromise(r(this.value))}unwrapOr(r){return this.value}match(r,e){return r(this.value)}safeUnwrap(){const r=this.value;return function*(){return r}()}_unsafeUnwrap(r){return this.value}_unsafeUnwrapErr(r){throw x("Called `_unsafeUnwrapErr` on an Ok",this,r)}*[Symbol.iterator](){return this.value}}class f{constructor(r){this.error=r}isOk(){return!1}isErr(){return!this.isOk()}map(r){return l(this.error)}mapErr(r){return l(r(this.error))}andThrough(r){return l(this.error)}andTee(r){return l(this.error)}orTee(r){try{r(this.error)}catch{}return l(this.error)}andThen(r){return l(this.error)}orElse(r){return r(this.error)}asyncAndThen(r){return g(this.error)}asyncAndThrough(r){return g(this.error)}asyncMap(r){return g(this.error)}unwrapOr(r){return r}match(r,e){return e(this.error)}safeUnwrap(){const r=this.error;return function*(){throw yield l(r),new Error("Do not use this generator out of `safeTry`")}()}_unsafeUnwrap(r){throw x("Called `_unsafeUnwrap` on an Err",this,r)}_unsafeUnwrapErr(r){return this.error}*[Symbol.iterator](){const r=this;return yield r,r}}T.fromThrowable,document.addEventListener("mouseup",W);async function W(){const t=await q();if(t.isErr())return;const r=await z(t.value);r.isErr()||(console.log(r.value),D(r.value))}async function q(){const t=window.getSelection();if(!t||t.rangeCount===0||t.isCollapsed)return l({code:1,message:"error"});const r=t.getRangeAt(0),e=document.querySelector(".selection-translate-popup");return e&&(e.contains(r.startContainer)||e.contains(r.endContainer))?l({code:1,message:"error"}):d(t.toString())}async function z(t){try{const e=await(await Translator.create({sourceLanguage:"en",targetLanguage:"ja"})).translate(t);return d(e)}catch{return l({code:2,message:"error"})}}function D(t){const r=document.querySelector(".selection-translate-popup");r&&r.remove();const e=window.getSelection();if(!e||e.rangeCount===0)return;const o=e.getRangeAt(0).getBoundingClientRect(),i=document.createElement("div");i.className="selection-translate-popup",i.textContent=t,i.style.cssText=`
  position: absolute;
  left: ${o.left+window.scrollX}px;
  top: ${o.bottom+window.scrollY+5}px;
  z-index: 10000;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: white;
  padding: 8px 12px;
  border-radius: 12px;
  font-size: 14px;
  max-width: 300px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3),
              0 0 0 1px rgba(255, 255, 255, 0.1) inset;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
`,document.body.appendChild(i);const a=c=>{const h=c.target;i.contains(h)||(i.remove(),document.removeEventListener("click",a))};setTimeout(()=>{document.addEventListener("click",a)},0)}})();
